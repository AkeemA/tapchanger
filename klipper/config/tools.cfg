
[ktcclog]  # Log_level & logfile_level can be set to one of (0 = essential, 1 = info, 2 = debug, 3 = trace)
log_level: 1
logfile_level: 1

[toollock]
tool_lock_gcode:
tool_unlock_gcode:

[delayed_gcode check_active_tool_on_startup]
initial_duration: 1
gcode:
    RESPOND TYPE=echo MSG='Updating active tool from probe status.'
    DETECT_ACTIVE_TOOL_PROBE
    SAVE_CURRENT_TOOL T={printer.tool_probe_endstop.active_tool}       

[toolgroup 0]
pickup_gcode: 
  M568 P{myself.name} A2                                               # Put tool heater in Active mode
  SAVE_GCODE_STATE NAME=TOOL_PICKUP                                    # Save GCODE state. Will be restored at the end of pickup code
  G90

##### TODO!
# G0 X214.00 Y80 Z241 F10000
# G0 X214 Y-5 Z241 F5000
# G0 Y-8.3 Z241.5 F1000
# G0 Y-8.3 Z251 F1000
# G0 Y-8.3 Z285 F3000
# G0 Y-1 Z285 F1000
# G0 Z293 Y7 F1000
# G0 X214.00 Y80 Z293 F10000


#   ##############  Move in to zone  ##############
#   G0 X500 F40000                                                       # Fast move X inside the safezone, so we don't crash into other tools.
#   G0 Y{myself.zone[1]} F40000                                          # Fast move Y in front of parking spot.

#   ##############  Move in to parking spot  ##############
#   G0 X{myself.park[0]|int - 15}  F40000                                # Fast Move near the pickup position for tool.
#   G0 X{myself.park[0]} F3000                                           # Slow Move to the pickup position for tool.

#   ##############  Lock Tool  ##############
#   SET_GCODE_OFFSET Z={myself.offset[2]} MOVE=1                         # Set and move the Z offset. Avoid crashing into bed when moving out later.

#   ##############  Wait for heater  ##############
#   {% if myself.extruder|default("none")|lower !="none" %}              # If the tool has an extruder:
#     TEMPERATURE_WAIT_WITH_TOLERANCE TOOL={myself.name}                 # Wait for tool to reach target temperature.
#   {% endif %}                                                          # /

#   ##############  Move out to zone  ##############
#   G0 X{myself.zone[0]} F6000                                           # Slow Move to the zone position for tool.

#   ##############  Move out to Safe position  ##############
#   G0 X500 F40000                                                       # Fast Move to the safe position for tools.

  ##############  Finish up  ##############
  M400                                                                 # Wait for current moves to finish.
  RESTORE_GCODE_STATE NAME=TOOL_PICKUP MOVE=0                          # Restore GCODE state. Was saved at thebegining of SUB_TOOL_PICKUP_START. Move fast to last location.
                                                                       # Set the toolhead offsets. Z is set and moved before any moves in SUB_TOOL_PICKUP_START. Needs to be after any RESTORE_GCODE_STATE!
  SET_GCODE_OFFSET X={myself.offset[0]} Y={myself.offset[1]} Z={myself.offset[2]} MOVE=0  # Set X and Y offsets, 
  DETECT_ACTIVE_TOOL_PROBE

dropoff_gcode:
  SET_GCODE_OFFSET X=0 Y=0                                      # Set XY offset to 0 so we park the tool right.
  SAVE_GCODE_STATE NAME=TOOL_DROPOFF_002                        # Save GCode state.
  G90         
  
### TODO
# G0 X214.00 Y80 Z293 F10000
# G0 Z293 Y7 F5000
# G0 Y-1 Z285 F1000
# G0 Y-5 Z285 F1000
# G0 Y-8.3 Z285 F500
# G0 Y-8.3 Z270 F1000
# G0 Y-8.3 Z241.5 F3000
# G0 X214.00 Y80 Z241.5 F10000
# Absolute positions

  # Fast Move to the general pickup position for tools.
#   G0 X500 F40000               # Move X and lift z so we don't crash the bed or into other tools.
#   G0 Y{myself.zone[1]} F40000            # Move Y after X and Z
#   M400                                # Wait for current moves to finish

#   G0 X{myself.zone[0]} F40000              # Fast Move near the dropoff position for tool.
#   G0 X{myself.park[0]} F3000               # Slow Move to the dropoff position for tool.

  M400                                # Wait for current moves to finish
  RESTORE_GCODE_STATE NAME=TOOL_DROPOFF_002 MOVE=0   # Restore Gcode state



[tool 0]
tool_group: 0
extruder: extruder
fan: e0_partfan
zone: 214,80,241
park: 214,-8.3,285
offset: 0,0,0
meltzonelength: 18

[tool 1]
tool_group: 0
extruder: extruder1
fan: e1_partfan
zone: 315,80,241
park: 315,-8.3,285
offset: 0,0,0
meltzonelength: 18
